<!DOCTYPE html>
<html>
<head>
    <title>Data Collector for Google Sheets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .data-card {
            background: rgba(0, 0, 0, 0.3);
            margin: 20px 0;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #4CAF50;
            transition: transform 0.3s ease;
        }
        .data-card:hover {
            transform: translateY(-2px);
        }
        .data-card h3 {
            margin-bottom: 15px;
            color: #4CAF50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            padding: 15px 30px;
            margin: 10px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .main-btn {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            padding: 18px 40px;
            font-size: 18px;
            display: block;
            margin: 30px auto;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid #2196F3;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border-left-color: #4CAF50;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border-left-color: #f44336;
        }
        .status.warning {
            background: rgba(255, 152, 0, 0.2);
            border-left-color: #FF9800;
        }
        .data-preview {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        .feature-list {
            list-style: none;
            margin: 20px 0;
        }
        .feature-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .feature-list li:before {
            content: "‚úÖ";
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Data Collector</h1>
        <p class="subtitle">Collect visitor data and automatically save to Google Sheets</p>

        <div class="data-card">
            <h3>üöÄ Quick Start</h3>
            <p>Click the button below to collect comprehensive data and send it directly to your Google Sheet.</p>
            <button class="main-btn" onclick="collectAndSendAllData()">
                üéØ Collect & Send All Data
            </button>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="dataCount">0</div>
                <div>Data Points</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="ipCount">0</div>
                <div>IP Addresses</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successCount">0</div>
                <div>Successful Sends</div>
            </div>
        </div>

        <div class="data-card">
            <h3>üîß Manual Collection</h3>
            <button onclick="collectBasicInfo()">Basic Info & IP</button>
            <button onclick="collectLocation()">GPS Location</button>
            <button onclick="collectNetworkInfo()">Network Data</button>
            <button onclick="collectAdvancedInfo()">Advanced Fingerprint</button>
            <div id="manualStatus" class="status">Ready for manual data collection</div>
        </div>

        <div class="data-card">
            <h3>üìà Data Preview</h3>
            <div class="data-preview">
                <pre id="dataPreview">No data collected yet. Click "Collect & Send All Data" to start.</pre>
            </div>
        </div>

        <div class="data-card">
            <h3>üìã What We Collect</h3>
            <ul class="feature-list">
                <li>IP Address & Network Information</li>
                <li>Browser Fingerprinting Data</li>
                <li>GPS Location (with permission)</li>
                <li>Social Media Presence Detection</li>
                <li>Local Network Information</li>
                <li>Hardware Specifications</li>
                <li>Browser & OS Details</li>
                <li>Screen & Display Information</li>
                <li>Timezone & Language Settings</li>
            </ul>
        </div>

        <div id="globalStatus" class="status">
            üîÑ System Ready - Waiting for data collection
        </div>
    </div>

    <script>
        // CONFIGURATION - Replace with your Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzqsbkx5_MrzJM3PxMjxOBHZNKIZaDqKpOP6gNzhkOvutusFrNE_L7dSvTzAyR_WBu4hw/exec';
        
        let collectedData = {};
        let stats = {
            dataPoints: 0,
            uniqueIPs: new Set(),
            successfulSends: 0
        };

        // Main function to collect and send all data
        async function collectAndSendAllData() {
            updateGlobalStatus('üîÑ Starting comprehensive data collection...', 'info');
            
            try {
                // Collect all data
                collectedData = await collectAllData();
                stats.dataPoints = Object.keys(collectedData).length;
                
                updateDataPreview();
                updateStats();
                updateGlobalStatus('‚úÖ Data collected! Sending to Google Sheets...', 'success');
                
                // Send to Google Sheets
                await sendToGoogleSheets(collectedData);
                
            } catch (error) {
                updateGlobalStatus('‚ùå Error: ' + error.message, 'error');
            }
        }

        // Comprehensive data collection
        async function collectAllData() {
            const data = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                referrer: document.referrer
            };

            // Basic browser info
            data.userAgent = navigator.userAgent;
            data.platform = navigator.platform;
            data.language = navigator.language;
            data.languages = navigator.languages;
            data.cookiesEnabled = navigator.cookieEnabled;
            data.hardwareConcurrency = navigator.hardwareConcurrency || 'Unknown';
            data.deviceMemory = navigator.deviceMemory || 'Unknown';

            // Screen info
            data.screen = `${screen.width}x${screen.height}`;
            data.colorDepth = screen.colorDepth;
            data.pixelDepth = screen.pixelDepth;

            // Timezone
            data.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            // Get IP address
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                data.ip = ipData.ip;
                stats.uniqueIPs.add(ipData.ip);
            } catch (error) {
                data.ip = 'Unknown';
            }

            // Local IP via WebRTC
            data.localIP = await getLocalIP();

            // Network information
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (connection) {
                data.networkType = connection.effectiveType;
                data.networkDownlink = connection.downlink;
                data.networkRTT = connection.rtt;
            }

            // Social media detection
            data.socialMedia = await checkSocialMediaPresence();

            return data;
        }

        // Individual collection functions
        async function collectBasicInfo() {
            const basicData = await collectAllData();
            collectedData = { ...collectedData, ...basicData };
            updateDataPreview();
            updateManualStatus('‚úÖ Basic information collected!', 'success');
        }

        async function collectLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    updateManualStatus('‚ùå Geolocation not supported', 'error');
                    resolve();
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    position => {
                        collectedData.location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        updateDataPreview();
                        updateManualStatus('‚úÖ Location data collected!', 'success');
                        resolve();
                    },
                    error => {
                        updateManualStatus('‚ùå Location access denied', 'error');
                        resolve();
                    }
                );
            });
        }

        async function collectNetworkInfo() {
            collectedData.networkScan = await scanLocalNetwork();
            collectedData.localIP = await getLocalIP();
            updateDataPreview();
            updateManualStatus('‚úÖ Network information collected!', 'success');
        }

        async function collectAdvancedInfo() {
            collectedData.advancedFingerprint = {
                webgl: getWebGLInfo(),
                canvas: getCanvasFingerprint(),
                fonts: await getFontsList(),
                audio: getAudioFingerprint()
            };
            updateDataPreview();
            updateManualStatus('‚úÖ Advanced fingerprint collected!', 'success');
        }

        // Send data to Google Sheets
        async function sendToGoogleSheets(data) {
            try {
                updateGlobalStatus('üîÑ Sending data to Google Sheets...', 'info');

                // Method 1: JSONP with callback
                await sendViaJSONP(data);
                
                stats.successfulSends++;
                updateStats();
                updateGlobalStatus('‚úÖ Data successfully saved to Google Sheets!', 'success');
                
            } catch (error) {
                updateGlobalStatus('‚ùå Failed to send data: ' + error.message, 'error');
            }
        }

        // JSONP method for CORS bypass
        function sendViaJSONP(data) {
            return new Promise((resolve, reject) => {
                const callbackName = 'callback_' + Date.now();
                const script = document.createElement('script');
                
                window[callbackName] = function(response) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    
                    if (response.status === 'success') {
                        resolve(response);
                    } else {
                        reject(new Error(response.message));
                    }
                };

                const encodedData = encodeURIComponent(JSON.stringify(data));
                const url = `${GOOGLE_SCRIPT_URL}?callback=${callbackName}&data=${encodedData}`;
                
                script.src = url;
                script.onerror = () => reject(new Error('JSONP request failed'));
                document.body.appendChild(script);
            });
        }

        // Helper functions
        async function getLocalIP() {
            return new Promise((resolve) => {
                const pc = new RTCPeerConnection({iceServers: []});
                pc.createDataChannel('');
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                pc.onicecandidate = ice => {
                    if (ice.candidate) {
                        const ip = ice.candidate.candidate.split(' ')[4];
                        resolve(ip);
                        pc.close();
                    }
                };
                setTimeout(() => resolve('Unknown'), 2000);
            });
        }

        async function checkSocialMediaPresence() {
            const services = [
                'https://facebook.com', 'https://twitter.com', 
                'https://linkedin.com', 'https://instagram.com',
                'https://github.com'
            ];
            const results = {};
            
            for (const service of services) {
                results[service] = await checkService(service);
            }
            return results;
        }

        function checkService(url) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url + '/favicon.ico';
                setTimeout(() => resolve(false), 1500);
            });
        }

        async function scanLocalNetwork() {
            const commonIPs = ['192.168.1.1', '192.168.0.1', '10.0.0.1'];
            const results = {};
            
            for (const ip of commonIPs) {
                results[ip] = await pingIP(ip);
            }
            return results;
        }

        function pingIP(ip) {
            return new Promise(resolve => {
                const img = new Image();
                const start = Date.now();
                img.onload = () => resolve({ reachable: true, time: Date.now() - start });
                img.onerror = () => resolve({ reachable: false, time: null });
                img.src = `http://${ip}/favicon.ico?t=${Date.now()}`;
                setTimeout(() => resolve({ reachable: false, time: null }), 2000);
            });
        }

        function getWebGLInfo() {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl');
            return gl ? {
                vendor: gl.getParameter(gl.VENDOR),
                renderer: gl.getParameter(gl.RENDERER)
            } : null;
        }

        function getCanvasFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Canvas fingerprint', 2, 2);
            return canvas.toDataURL().substring(0, 100) + '...';
        }

        function getAudioFingerprint() {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                return context.sampleRate;
            } catch (e) {
                return null;
            }
        }

        async function getFontsList() {
            const fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Courier New', 'Verdana'];
            const available = [];
            for (const font of fonts) {
                if (document.fonts.check(`12px "${font}"`)) {
                    available.push(font);
                }
            }
            return available;
        }

        // UI update functions
        function updateDataPreview() {
            document.getElementById('dataPreview').textContent = 
                JSON.stringify(collectedData, null, 2);
        }

        function updateStats() {
            document.getElementById('dataCount').textContent = stats.dataPoints;
            document.getElementById('ipCount').textContent = stats.uniqueIPs.size;
            document.getElementById('successCount').textContent = stats.successfulSends;
        }

        function updateGlobalStatus(message, type = 'info') {
            const status = document.getElementById('globalStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function updateManualStatus(message, type = 'info') {
            const status = document.getElementById('manualStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Initialize
        window.addEventListener('load', () => {
            updateGlobalStatus('‚úÖ System Ready - Click "Collect & Send All Data" to start', 'success');
            updateStats();
        });
    </script>
</body>
</html>
